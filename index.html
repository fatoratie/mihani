<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مهني MIHANI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e90ff;
            --secondary-color: #f0f8ff;
            --accent-color: #6c757d;
            --text-color: #333;
            --border-color: #ddd;
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', Arial, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            max-width: 200px;
            height: auto;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }

        .search-input {
            padding: 10px;
            width: 300px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-right: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: bold;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1873cc;
        }

        .btn-secondary {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .form-container {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30,144,255,0.2);
        }

        .profile-image-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-image-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 10px auto;
            border: 3px solid var(--primary-color);
            display: none;
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .additional-image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
        }

        .professional-card {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .professional-card:hover {
            transform: translateY(-2px);
        }

        .professional-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-left: 20px;
            object-fit: cover;
        }

        .professional-info {
            flex-grow: 1;
        }

        .professional-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .professional-details {
            color: #666;
        }

        .contact-buttons {
            display: flex;
            gap: 10px;
        }

        .contact-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--primary-color);
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s ease;
        }

        .contact-btn:hover {
            color: #1873cc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: left;
            font-size: 24px;
            cursor: pointer;
        }

        .work-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .work-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .work-image:hover {
            transform: scale(1.05);
        }

        .social-links {
            margin-top: 15px;
        }

        .social-link {
            color: var(--primary-color);
            text-decoration: none;
            margin-left: 15px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .social-link i {
            font-size: 1.2em;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success-color);
            color: white;
            border-radius: 8px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .admin-controls {
            display: none;
            margin-top: 10px;
        }

        .delete-btn {
            background-color: var(--error-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }

        .edit-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .fullscreen-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            cursor: pointer;
        }

        .fullscreen-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
    
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="MIHANI Logo" class="logo">
            <h1>منصة مهني - MIHANI</h1>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="showRegistrationForm()">تسجيل مهني جديد</button>
            <button class="btn btn-secondary" onclick="showLoginForm()">تسجيل الدخول</button>
            <button class="btn btn-primary" onclick="showSearchForm()">البحث عن مهني</button>
        </div>

        <div class="search-container" id="searchForm" style="display: none;">
            <input type="text" class="search-input" id="searchInput" placeholder="ابحث عن مهني حسب الاسم، المهنة، أو العنوان" oninput="searchProfessionals()">
        </div>

        <div class="form-container" id="loginForm" style="display: none;">
            <h2>تسجيل الدخول</h2>
            <div class="form-group">
                <label class="form-label">اسم المستخدم</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="form-group">
                <label class="form-label">كلمة المرور</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button class="btn btn-primary" onclick="login()">دخول</button>
        </div>

        <div class="form-container" id="registrationForm" style="display: none;">
            <h2>تسجيل مهني جديد</h2>
            <div class="profile-image-container">
                <img id="profilePreview" class="profile-image-preview">
                <input type="file" id="profileImage" accept="image/*" onchange="previewProfileImage(event)">
            </div>
            <div class="form-group">
                <label class="form-label">الاسم الكامل</label>
                <input type="text" class="form-control" id="fullName" required>
            </div>
            <div class="form-group">
                <label class="form-label">المهنة</label>
                <input type="text" class="form-control" id="profession" required>
            </div>
            <div class="form-group">
                <label class="form-label">رقم الهاتف</label>
                <input type="tel" class="form-control" id="phone" required>
            </div>
            <div class="form-group">
                <label class="form-label">العنوان</label>
                <input type="text" class="form-control" id="address" required>
            </div>
            <div class="form-group">
                <label class="form-label">وصف مختصر للعمل</label>
                <textarea class="form-control" id="description" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">روابط التواصل الاجتماعي (اختياري)</label>
                <input type="url" class="form-control" id="facebook" placeholder="رابط الفيسبوك">
                <input type="url" class="form-control" id="instagram" placeholder="رابط الانستغرام">
            </div>
            <div class="form-group">
                <label class="form-label">صور أعمالك</label>
                <input type="file" multiple accept="image/*" id="workImages" onchange="previewWorkImages(event)">
                <div class="image-preview-container" id="workImagesPreview"></div>
            </div>
            <button class="btn btn-primary" onclick="submitForm()">تسجيل</button>
        </div>

        <div id="professionalsList"></div>
    </div>

    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const ADMIN_USERNAME = 'MOAY';
        const ADMIN_PASSWORD = 'moay@1983';
        let isAdmin = false;
        let professionals = [];
        let currentUser = null;

        // دوال حفظ واسترجاع البيانات
        function saveProfessionals() {
            try {
                localStorage.setItem('mihani_professionals', JSON.stringify(professionals));
            } catch (error) {
                console.error('خطأ في حفظ البيانات:', error);
                showToast('حدث خطأ في حفظ البيانات', 'error');
            }
        }

        function loadProfessionals() {
            try {
                const saved = localStorage.getItem('mihani_professionals');
                if (saved) {
                    professionals = JSON.parse(saved);
                    updateProfessionalsList();
                }
            } catch (error) {
                console.error('خطأ في تحميل البيانات:', error);
                showToast('حدث خطأ في تحميل البيانات', 'error');
            }
        }

        function showSearchForm() {
            document.getElementById('searchForm').style.display = 'block';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registrationForm').style.display = 'none';
            updateProfessionalsList();
        }

        function showLoginForm() {
            document.getElementById('searchForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registrationForm').style.display = 'none';
        }

        function showRegistrationForm() {
            document.getElementById('searchForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registrationForm').style.display = 'block';
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdmin = true;
                currentUser = { username: ADMIN_USERNAME, isAdmin: true };
                showToast('تم تسجيل الدخول كمسؤول');
                showSearchForm();
                showAdminControls();
            } else {
                const professional = professionals.find(p => p.username === username && p.password === password);
                if (professional) {
                    currentUser = professional;
                    showToast('تم تسجيل الدخول بنجاح');
                    loadProfessionalData(professional);
                } else {
                    showToast('خطأ في اسم المستخدم أو كلمة المرور', 'error');
                }
            }
        }

        function showAdminControls() {
            const adminControls = document.querySelectorAll('.admin-controls');
            adminControls.forEach(control => control.style.display = 'block');
        }

        function previewProfileImage(event) {
            const preview = document.getElementById('profilePreview');
            preview.style.display = 'block';
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function previewWorkImages(event) {
            const container = document.getElementById('workImagesPreview');
            container.innerHTML = ''; // مسح الصور السابقة
            const files = event.target.files;
            
            if (files) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'additional-image-preview';
                        container.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        function searchProfessionals() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredProfessionals = professionals.filter(professional => 
                professional.fullName.toLowerCase().includes(searchTerm) ||
                professional.profession.toLowerCase().includes(searchTerm) ||
                professional.address.toLowerCase().includes(searchTerm)
            );
            updateProfessionalsList(filteredProfessionals);
        }

        function submitForm() {
            const fullName = document.getElementById('fullName').value;
            const profession = document.getElementById('profession').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const description = document.getElementById('description').value;
            const facebook = document.getElementById('facebook').value;
            const instagram = document.getElementById('instagram').value;
            const workImagesElements = document.getElementById('workImagesPreview').getElementsByTagName('img');
            const workImages = Array.from(workImagesElements).map(img => img.src);

            if (!fullName || !profession || !phone || !address) {
                showToast('الرجاء ملء جميع الحقول المطلوبة', 'error');
                return;
            }

            if (!currentUser) {
                const username = prompt('الرجاء إدخال اسم المستخدم');
                const password = prompt('الرجاء إدخال كلمة المرور (4 أحرف أو أرقام على الأقل)');

                if (username && password && password.length >= 4) {
                    const professional = {
                        id: Date.now(),
                        fullName,
                        profession,
                        phone,
                        address,
                        description,
                        facebook,
                        instagram,
                        username,
                        password,
                        profileImage: document.getElementById('profilePreview').src,
                        workImages: workImages
                    };

                    professionals.push(professional);
                    currentUser = professional;
                    saveProfessionals();
                    showToast('تم التسجيل بنجاح');
                    showSearchForm();
                } else {
                    showToast('يجب إدخال اسم مستخدم وكلمة مرور صحيحة', 'error');
                    return;
                }
            } else {
                const index = professionals.findIndex(p => p.id === currentUser.id);
                if (index !== -1) {
                    professionals[index] = {
                        ...professionals[index],
                        fullName,
                        profession,
                        phone,
                        address,
                        description,
                        facebook,
                        instagram,
                        profileImage: document.getElementById('profilePreview').src,
                        workImages: workImages
                    };
                    saveProfessionals();
                    showToast('تم تحديث البيانات بنجاح');
                    showSearchForm();
                }
            }

            clearForm();
            updateProfessionalsList();
        }

        function clearForm() {
            document.getElementById('fullName').value = '';
            document.getElementById('profession').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('address').value = '';
            document.getElementById('description').value = '';
            document.getElementById('facebook').value = '';
            document.getElementById('instagram').value = '';
            document.getElementById('profilePreview').src = '';
            document.getElementById('profilePreview').style.display = 'none';
            document.getElementById('workImagesPreview').innerHTML = '';
        }

        function showDetails(professional) {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <h2>${professional.fullName}</h2>
                <p><strong>المهنة:</strong> ${professional.profession}</p>
                <p><strong>العنوان:</strong> ${professional.address}</p>
                <p><strong>الوصف:</strong> ${professional.description || 'لا يوجد وصف'}</p>
                
                ${professional.workImages && professional.workImages.length > 0 ? `
                    <h3>معرض الأعمال</h3>
                    <div class="work-images-grid">
                        ${professional.workImages.map(img => `
                            <img src="${img}" class="work-image" alt="صورة عمل" onclick="showFullImage('${img}')">
                        `).join('')}
                    </div>
                ` : '<p>لا توجد صور أعمال</p>'}
                
                <div class="social-links">
                    ${professional.facebook ? `
                        <a href="${professional.facebook}" target="_blank" class="social-link">
                            <i class="fab fa-facebook"></i> فيسبوك
                        </a>
                    ` : ''}
                    ${professional.instagram ? `
                        <a href="${professional.instagram}" target="_blank" class="social-link">
                            <i class="fab fa-instagram"></i> انستغرام
                        </a>
                    ` : ''}
                </div>
            `;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function showFullImage(src) {
            const fullscreenDiv = document.createElement('div');
            fullscreenDiv.className = 'fullscreen-image';
            
            const img = document.createElement('img');
            img.src = src;
            
            fullscreenDiv.onclick = () => document.body.removeChild(fullscreenDiv);
            fullscreenDiv.appendChild(img);
            document.body.appendChild(fullscreenDiv);
        }

        function closeModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        function updateProfessionalsList(professionalsToShow = professionals) {
            const container = document.getElementById('professionalsList');
            container.innerHTML = '';

            professionalsToShow.forEach(professional => {
                const card = document.createElement('div');
                card.className = 'professional-card';
                card.innerHTML = `
                    <img src="${professional.profileImage}" alt="${professional.fullName}" class="professional-avatar">
                    <div class="professional-info">
                        <div class="professional-name">${professional.fullName}</div>
                        <div class="professional-details">
                            <div>المهنة: ${professional.profession}</div>
                            <div>العنوان: ${professional.address}</div>
                        </div>
                    </div>
                    <div class="contact-buttons">
                        <button class="contact-btn" onclick="window.location.href='tel:${professional.phone}'">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="contact-btn" onclick="showDetails(${JSON.stringify(professional).replace(/"/g, '&quot;')})">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                    ${isAdmin ? `
                        <div class="admin-controls">
                            <button class="edit-btn" onclick="editProfessional(${professional.id})">تعديل</button>
                            <button class="delete-btn" onclick="deleteProfessional(${professional.id})">حذف</button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(card);
            });
        }

        function deleteProfessional(id) {
            if (!isAdmin) return;
            professionals = professionals.filter(p => p.id !== id);
            saveProfessionals();
            updateProfessionalsList();
            showToast('تم حذف الحساب بنجاح');
        }

        function editProfessional(id) {
            if (!isAdmin) return;
            const professional = professionals.find(p => p.id === id);
            if (professional) {
                currentUser = professional;
                document.getElementById('fullName').value = professional.fullName;
                document.getElementById('profession').value = professional.profession;
                document.getElementById('phone').value = professional.phone;
                document.getElementById('address').value = professional.address;
                document.getElementById('description').value = professional.description || '';
                document.getElementById('facebook').value = professional.facebook || '';
                document.getElementById('instagram').value = professional.instagram || '';
                document.getElementById('profilePreview').src = professional.profileImage;
                document.getElementById('profilePreview').style.display = 'block';

                const workImagesPreview = document.getElementById('workImagesPreview');
                workImagesPreview.innerHTML = '';
                professional.workImages.forEach(imgSrc => {
                    const img = document.createElement('img');
                    img.src = imgSrc;
                    img.className = 'additional-image-preview';
                    workImagesPreview.appendChild(img);
                });

                showRegistrationForm();
            }
        }

        function loadProfessionalData(professional) {
            document.getElementById('fullName').value = professional.fullName;
            document.getElementById('profession').value = professional.profession;
            document.getElementById('phone').value = professional.phone;
            document.getElementById('address').value = professional.address;
            document.getElementById('description').value = professional.description || '';
            document.getElementById('facebook').value = professional.facebook || '';
            document.getElementById('instagram').value = professional.instagram || '';
            document.getElementById('profilePreview').src = professional.profileImage;
            document.getElementById('profilePreview').style.display = 'block';

            const workImagesPreview = document.getElementById('workImagesPreview');
            workImagesPreview.innerHTML = '';
            professional.workImages.forEach(imgSrc => {
                const img = document.createElement('img');
                img.src = imgSrc;
                img.className = 'additional-image-preview';
                workImagesPreview.appendChild(img);
            });

            showRegistrationForm();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? 'var(--success-color)' : 'var(--error-color)';
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // تحميل البيانات عند بدء التطبيق
        window.onload = function() {
            loadProfessionals();
            showSearchForm();
        };
    </script>
</body>
</html>
